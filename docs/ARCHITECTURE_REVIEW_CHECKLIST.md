# 🏛️ 架构守护者审查清单 (Architecture Review Checklist)

## 📋 使用说明

当 Solo 提交任何架构相关的 PR 时，架构守护者必须按照此清单进行标准化审查，并在 PR 评论中逐项打钩确认。

---

## ✅ 功能一致性审查 (Functional Consistency)

- [ ] **UI 功能完整性**：所有原有功能在 reviewer 本地环境可正常重现
  - [ ] CRUD 操作（创建、读取、更新、删除）
  - [ ] Generate 功能（手动生成、定时生成）
  - [ ] 订阅管理（订阅、取消订阅）
  - [ ] 搜索与筛选功能
  - [ ] 模态框与交互组件

- [ ] **用户体验一致性**：界面行为、响应速度、错误提示与拆分前保持一致
- [ ] **数据展示正确性**：卡片渲染、列表展示、详情页面数据正确显示

---

## ✅ 模块边界审查 (Module Boundary)

- [ ] **Yin-Yang 架构原则**：严格遵循阴阳分离原则
  - [ ] **Yin (后端/数据层)**：不包含任何 DOM 操作或 UI 逻辑
  - [ ] **Yang (前端/表现层)**：不包含业务规则或数据验证逻辑

- [ ] **职责分离** (基于 MODULE_SPLIT.md)：
  - [ ] **Controller**：仅包含业务逻辑，不直接操作 DOM
  - [ ] **View**：仅负责 DOM 渲染和事件绑定，不包含业务规则
  - [ ] **Service**：封装外部调用（API、AI服务），保持纯函数特性
  - [ ] **Template**：纯函数，仅返回 HTML 字符串

---

## ✅ 接口契约审查 (Interface Contract)

- [ ] **函数签名清晰**：所有公共函数包含完整的 JSDoc 注释
  - [ ] 参数说明（类型、含义、是否可选）
  - [ ] 返回值说明（类型、结构）
  - [ ] 异常说明（可能抛出的错误类型）

- [ ] **类型一致性**：
  - [ ] ID 字段类型统一（字符串/数字）
  - [ ] 日期时间格式标准化
  - [ ] URL 规范化处理
  - [ ] 布尔值字段命名规范（is/has/can 前缀）

---

## ✅ 错误处理审查 (Error Handling)

- [ ] **异步操作保护**：所有关键异步操作都有 try/catch 包裹
  - [ ] 数据库操作（IndexedDB、Supabase）
  - [ ] API 调用（AI服务、外部接口）
  - [ ] 文件操作（导入、导出）

- [ ] **用户可见提示**：错误发生时用户能收到清晰反馈
  - [ ] 错误消息本地化（中文）
  - [ ] 错误级别区分（警告、错误、致命）
  - [ ] 恢复建议提供（如重试、联系支持）

---

## ✅ 事件委托审查 (Event Delegation)

- [ ] **事件委托机制**：View 层继续使用事件委托，无新增元素级监听器
  - [ ] 使用 `delegate()` 函数而非 `addEventListener()`
  - [ ] 事件选择器保持稳定（`.rune-card`, `.btn-delete` 等）
  - [ ] data-attributes 完整性检查（`data-card-id`, `data-subscription-id`）

- [ ] **性能考虑**：
  - [ ] 事件监听器数量合理（避免过多委托）
  - [ ] 事件处理函数高效（避免重复查询 DOM）

---

## ✅ 数据一致性审查 (Data Consistency)

- [ ] **ID 映射关系**：保持原有映射关系不变
  - [ ] `linkId` ↔ `website_id` 映射一致性
  - [ ] `user_id` 字段类型和值域一致性
  - [ ] `subscription_id` 生成规则不变

- [ ] **数据格式兼容**：
  - [ ] 字符串/数字类型转换处理
  - [ ] 老数据格式向后兼容
  - [ ] 空值和默认值处理一致

---

## ✅ 文档更新审查 (Documentation)

- [ ] **路径变更记录**：如修改文件路径或导出方式，更新相关文档
  - [ ] MODULE_SPLIT.md 中的对应条目
  - [ ] ARCHITECTURE.md 中的模块结构图
  - [ ] API 文档或接口说明

- [ ] **代码注释**：
  - [ ] 复杂业务逻辑有详细中文注释
  - [ ] 临时解决方案标注 TODO/FIXME
  - [ ] 第三方依赖使用说明

---

## ✅ 代码质量审查 (Code Quality)

- [ ] **小步合并原则**：PR 改动量符合小步规范
  - [ ] 代码行数适中（建议 < 500 行变更）
  - [ ] 单一职责（每个 PR 专注一个模块）
  - [ ] 可回滚性（改动可安全撤销）

- [ ] **代码风格**：
  - [ ] 遵循现有代码风格（缩进、命名、注释）
  - [ ] 无 console.log 调试代码残留
  - [ ] 无未使用的变量或导入

---

## 🏁 审查结论

### 审查结果标记

在 PR 评论中使用以下标记：

```markdown
## 🏛️ 架构审查结果

**Arch: PASS** ✅ 
- 所有检查项均已通过
- 符合 Yin-Yang 架构原则
- 可以安全合并

**Arch: Changes Requested** ❌
- [ ] 需要修改的问题1
- [ ] 需要修改的问题2
- [ ] 需要修改的问题3

**建议修改后重新提交审查**
```

---

## 📞 紧急情况处理

如遇到以下情况，请立即标记为 **Arch: BLOCKED** 并暂停合并：

1. **安全漏洞**：XSS、CSRF、数据泄露风险
2. **数据丢失风险**：可能破坏用户数据的操作
3. **系统崩溃**：导致应用无法运行的严重错误
4. **架构破坏**：违反核心架构原则且无法快速修复

---

## 📝 审查记录

每次审查后，请在 PR 中记录：

- 审查时间
- 审查者
- 主要发现和建议
- 后续跟进事项

---

*最后更新：2025年* | *版本：v1.0* | *制定者：架构守护者*