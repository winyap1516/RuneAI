<!DOCTYPE html>
<html class="light" lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rune AI Dashboard</title>
    <!-- ✅ 统一仅使用 Tailwind CDN（不再加载外部 CSS 文件） -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
    <!-- Supabase SDK (Phase 5) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      // ✅ Tailwind 配置：颜色与字体统一
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#4A69FF",
              secondary: "#8A4FFF",
              "background-light": "#F4F5F7",
              "background-dark": "#131022",
              "surface-light": "#FFFFFF",
              "surface-dark": "#1A172A",
              "text-primary-light": "#2D3748",
              "text-primary-dark": "#E2E8F0",
              "text-secondary-light": "#718096",
              "text-secondary-dark": "#A0AEC0",
            },
            fontFamily: { display: ["Inter", "sans-serif"] },
            borderRadius: { DEFAULT: "0.5rem", lg: "0.75rem", xl: "1rem", full: "9999px" },
          },
        },
      };
    </script>
    <!-- ✅ 组件样式：移除 @apply，改为原生 CSS，避免 CDN 模式下失效 -->
    <style>
      /* 中文注释：以下为用户系统与 Dashboard 的辅助类，全部使用原生 CSS，兼容 Tailwind CDN 模式 */
      .user-system-container { position: relative; }
      .user-avatar {
        width: 2.5rem; /* w-10 */
        height: 2.5rem; /* h-10 */
        border-radius: 9999px; /* rounded-full */
        cursor: pointer;
        transition: transform 0.2s ease, border-color 0.2s ease; /* transition-all duration-200 */
        border: 2px solid transparent; /* border-2 border-transparent */
      }
      .user-avatar:hover {
        transform: scale(1.05); /* hover:scale-105 */
        border-color: #4A69FF; /* hover:border-primary（取自 Tailwind 配置）*/
      }

      .user-dropdown {
        position: absolute; /* absolute */
        right: 0; /* right-0 */
        top: 3rem; /* top-12 */
        width: 16rem; /* w-64 */
        background-color: #FFFFFF; /* bg-surface-light */
        border: 1px solid #E5E7EB; /* border border-gray-200 */
        border-radius: 0.5rem; /* rounded-lg */
        box-shadow: 0 10px 15px rgba(0,0,0,0.1); /* shadow-lg */
        z-index: 50; /* z-50 */
        display: none; /* hidden */
      }
      .dark .user-dropdown { background-color: #1A172A; border-color: #374151; /* dark:bg-surface-dark dark:border-gray-700 */ }
      .user-dropdown.show { display: block; /* .show 状态显示 */ }

      .user-modal {
        position: fixed; /* fixed */
        inset: 0; /* inset-0 */
        background-color: rgba(0,0,0,0.5); /* bg-black/50 */
        z-index: 50; /* z-50 */
        display: none; /* hidden */
      }
      .user-modal.show { display: block; }

      .user-welcome-card {
        background-image: linear-gradient(to right, rgba(74,105,255,0.10), rgba(138,79,255,0.10)); /* from-primary/10 to-secondary/10 */
        border: 1px solid rgba(74,105,255,0.20); /* border-primary/20 */
        border-radius: 0.75rem; /* rounded-xl */
        padding: 1.5rem; /* p-6 */
      }
      .dark .user-welcome-card {
        background-image: linear-gradient(to right, rgba(74,105,255,0.20), rgba(138,79,255,0.20)); /* dark:... */
        border-color: rgba(74,105,255,0.30); /* dark:border-primary/30 */
      }

      .user-loading {
        display: inline-block; /* inline-block */
        width: 1rem; /* w-4 */
        height: 1rem; /* h-4 */
        border: 2px solid currentColor; /* border-2 border-current */
        border-top-color: transparent; /* border-t-transparent */
        border-radius: 9999px; /* rounded-full */
        animation: spin 1s linear infinite; /* animate-spin */
      }
      @keyframes spin { to { transform: rotate(360deg); } }

      /* 侧栏折叠辅助 */
      .aside-collapsed { width: 4.5rem !important; }
      /* 品牌标题渐变文字 */
      .brand-title { background: linear-gradient(90deg,#6E57E0,#8A7CF5); background-clip: text; -webkit-background-clip: text; color: transparent; }
    </style>
    <style>
      /* 材料图标文字属性（浏览器兼容调整） */
      .material-symbols-outlined { font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24; }
      .nav-section-title { opacity: 0.6; letter-spacing: 0.08em; font-weight: 700; font-size: 11px; }
      .soft-hover:hover { box-shadow: 0 0 16px rgba(74,105,255,0.18); }
      
      /* ========== Sidebar Collapse Mode ========== */
      /* 中文注释：折叠后宽度变窄，并加入宽度过渡动画 */
      .sidebar.aside-collapsed { 
        width: 4rem !important; /* ~64px */
        transition: width 180ms ease, box-shadow 200ms ease;
      }
      
      /* 中文注释：折叠后隐藏标题与标签，只留图标（包含品牌文字与副标题）*/
      .sidebar.aside-collapsed .nav-section-title,
      .sidebar.aside-collapsed .nav-label,
      .sidebar.aside-collapsed .brand-title,
      .sidebar.aside-collapsed .brand-text,
      .sidebar.aside-collapsed .brand-tagline,
      .sidebar.aside-collapsed p.text-sm,
      .sidebar.aside-collapsed #addCategoryBtn,
      .sidebar.aside-collapsed .material-symbols-outlined:not(:first-child) /* Hide expand/collapse arrows */
      { 
        display: none !important; 
      }

      /* Show only the first icon in nav items (the main icon) */
      .sidebar.aside-collapsed .nav-item .material-symbols-outlined:first-child,
      .sidebar.aside-collapsed #linksGroupHeader .material-symbols-outlined:first-child, /* This might hide the arrow if it's not first, let's be careful */
      .sidebar.aside-collapsed #aiGroupHeader .material-symbols-outlined:first-child,
      .sidebar.aside-collapsed #userGroupHeader .material-symbols-outlined:first-child {
        display: block !important;
        margin: 0 auto;
      }
      
      /* Ensure headers in collapsed mode center their content */
      .sidebar.aside-collapsed #linksGroupHeader,
      .sidebar.aside-collapsed #aiGroupHeader,
      .sidebar.aside-collapsed #userGroupHeader {
          justify-content: center !important;
          padding-left: 0 !important;
          padding-right: 0 !important;
      }
      /* Hide the arrow explicitly if it's the second child */
      .sidebar.aside-collapsed #linksGroupHeader .material-symbols-outlined:nth-child(2),
      .sidebar.aside-collapsed #aiGroupHeader .material-symbols-outlined:nth-child(2),
      .sidebar.aside-collapsed #userGroupHeader .material-symbols-outlined:nth-child(2) {
          display: none !important;
      }

      /* Hide category names in collapsed mode */
      .sidebar.aside-collapsed .category-filter {
          display: none !important;
      }
      /* Show only category dots/more menu trigger? Or maybe first letter? 
         User requirement: "包括 category item 的 icon 或首字母 avatar"
         Current category item HTML: <button class="category-filter ...">Name</button> ... <button class="category-more ...">...</button>
         We need to show SOMETHING.
         Let's style category-more to be centered and maybe that's enough? 
         Or we need to inject an icon/initial for categories.
         For now, let's center the 'more' button if it's the only thing visible, OR inject a pseudo-element for initial.
      */
      
      .sidebar.aside-collapsed [data-name] {
          justify-content: center !important;
          padding: 0.5rem 0 !important;
      }
      
      .sidebar.aside-collapsed [data-name] .category-filter {
          display: none !important;
      }

      /* In collapsed mode, we might want to show the first letter of the category name.
         Since we can't easily change HTML structure via CSS only, we might need JS helper or rely on the 'more' menu.
         However, user said "only icons (including category item's icon or initial avatar)".
         Existing category items don't have icons.
         Let's use the 'more' button as the handle for now, or add a pseudo-element if possible.
         Actually, the 'more' button (three dots) is a good handle for "Options".
         But for navigation, we usually want to filter.
         If I hide the filter button, users can't click the category to filter.
         So I should probably make the filter button show only the first letter.
         CSS trick: visibility: hidden for text, ::first-letter visible? 
         It's tricky with flexbox buttons.
         Let's try to just show the 'more' button for now as the user interaction point, 
         OR rely on tooltips to show the name.
         Let's stick to showing the 'more' button as the visual anchor, and maybe add a 'folder' icon.
      */
      
      /* 
         Strategy for Categories in Collapsed Mode:
         Hide text button.
         Show a 'folder' icon (inserted via JS or CSS pseudo) that represents the category.
         Clicking it filters?
         The current DOM has `category-filter` button.
         I will update JS to inject an icon into the category item, or use CSS ::before on the item wrapper.
      */
      .sidebar.aside-collapsed [data-name]::before {
          content: 'folder';
          font-family: 'Material Symbols Outlined';
          font-size: 24px;
          color: #A0AEC0;
          cursor: pointer;
          display: block;
      }
      .sidebar.aside-collapsed [data-name]:hover::before {
          color: #4A69FF;
      }
      /* Hide the original buttons in collapsed mode to avoid clutter, 
         but we need the click event on the ::before to trigger filter?
         ::before events bubble to the parent div. 
         The parent div `[data-name]` doesn't have a click handler, the children do.
         So clicking ::before won't trigger filter.
         Better approach: Make the `category-filter` button text transparent, and show an icon background or pseudo.
      */
      .sidebar.aside-collapsed .category-filter {
          display: block !important;
          width: 24px !important;
          flex: 0 0 auto !important;
          overflow: hidden;
          color: transparent;
          position: relative;
          padding: 0 !important;
          margin-right: 0 !important;
      }
      .sidebar.aside-collapsed .category-filter::before {
          content: 'folder';
          font-family: 'Material Symbols Outlined';
          font-size: 24px;
          color: #9CA3AF; /* text-gray-400 */
          position: absolute;
          left: 0;
          top: 50%;
          transform: translateY(-50%);
      }
      .sidebar.aside-collapsed .category-filter:hover::before {
          color: #4A69FF;
      }
      
      .sidebar.aside-collapsed .category-more {
          display: none !important; /* Hide 3-dots in collapsed mode to save space? Or keep it? 
                                      User said "三点菜单（…）在折叠状态仍工作". 
                                      If width is 64px, we can't fit both folder icon and 3-dots easily side-by-side.
                                      Maybe hover shows 3-dots? Or right click?
                                      Let's keep it simple: The "Folder" icon opens the filter. 
                                      The 3-dots... maybe we hide 3-dots and make the folder icon trigger menu on right click?
                                      Or: stacking them vertically? No.
                                      Let's try to fit them or just show the folder, and maybe the menu is accessible via the folder?
                                      Actually, if I hide the 3-dots, I lose the "Rename/Delete" functionality.
                                      User requirement: "三点菜单（…）在折叠状态仍工作... 鼠标 hover 在某个图标上显示 tooltip；点击图标后如果需要显示菜单..."
                                      This implies icons are clickable.
                                      Maybe I can make the Category Item just one icon (Folder), clicking it filters.
                                      And the Menu? 
                                      Maybe the user accepts that in collapsed mode, you only filter? 
                                      "三点菜单（…）在折叠状态仍工作" -> This strongly suggests it MUST work.
                                      So I should probably keep the `category-more` visible, or merge them.
                                      Let's try to keep `category-more` visible but small, maybe absolute positioned on hover?
                                      Or just show `category-more` INSTEAD of folder? No, then we can't filter.
                                      Let's show only the Filter Icon (Folder). 
                                      And allow the Menu to be triggered by... maybe long press or right click?
                                      Or: Just show the 3-dots icon as the category representation? 
                                      No, "Delete" is in the menu. "Filter" is the main action.
                                      Let's stick to: Sidebar collapsed -> Show Folder Icon. 
                                      Hovering Folder Icon -> Show Tooltip (Name).
                                      Where is the menu?
                                      Maybe I'll leave the 3-dots visible but very small or overlay?
                                      Actually, 64px is enough for one icon centered.
                                      If I have to support both, maybe the item height increases?
                                      Let's assume for now: In collapsed mode, the category item becomes just the "More" icon? No, that breaks filtering.
                                      Let's make the category item display the First Letter of the category name (Avatar style).
                                      And clicking it filters.
                                      How to access menu? Maybe the Avatar *is* the trigger for a combined menu (Filter / Options)?
                                      That changes behavior too much.
                                      Let's try: Show 3-dots icon. Clicking it opens menu. Menu has "Filter" option added?
                                      That's a code change.
                                      
                                      Alternative: Show Folder Icon. 
                                      The User said: "包括 category item 的 icon 或首字母 avatar".
                                      So I will convert the text button to a "First Letter" avatar.
                                      And keep the 3-dots button hidden, BUT make the Avatar context-menu (right click) trigger the menu?
                                      Or just keep both if I can squeeze them (24px + 24px = 48px, fits in 64px with tight padding).
                                      Let's try to fit both:
                                      Flex col? Or row with small gap.
                                      64px width. Padding x-2 (8px total). Content width 56px.
                                      Icon 20px. Gap 4px. MoreBtn 20px. Total 44px. It fits!
      */
     
      .sidebar.aside-collapsed [data-name] {
          padding: 4px !important;
          justify-content: center !important;
          gap: 2px !important;
      }
      .sidebar.aside-collapsed .category-filter {
          display: flex !important;
          align-items: center;
          justify-content: center;
          width: 28px !important;
          height: 28px !important;
          border-radius: 4px;
          background: #F3F4F6; /* bg-gray-100 */
          color: #4B5563;
          font-weight: bold;
          font-size: 14px;
          padding: 0 !important;
          margin: 0 !important;
      }
      .dark .sidebar.aside-collapsed .category-filter {
          background: rgba(255,255,255,0.1);
          color: #E5E7EB;
      }
      /* Show first letter only */
      .sidebar.aside-collapsed .category-filter {
          text-indent: -9999px;
          position: relative;
      }
      .sidebar.aside-collapsed .category-filter::after {
          content: attr(title); /* Use title attribute for content */
          text-indent: 0;
          position: absolute;
          left: 0;
          right: 0;
          text-align: center;
          display: block;
          overflow: hidden;
          white-space: nowrap;
          width: 100%;
          /* We need to extract first letter. CSS can't do substring. 
             JS needs to set a data attribute for the initial.
             I will update JS to set data-initial.
          */
          content: attr(data-initial);
      }

      .sidebar.aside-collapsed .category-more {
          width: 24px !important;
          height: 24px !important;
          padding: 0 !important;
          display: flex !important;
          align-items: center;
          justify-content: center;
      }
      .sidebar.aside-collapsed .category-more span {
          font-size: 18px !important;
      }
      
      /* 中文注释：折叠态居中显示 Logo 与图标 */
      .sidebar.aside-collapsed .sidebar-header { 
        justify-content: center !important; 
        padding-left: 0 !important;
        padding-right: 0 !important;
      }
      .sidebar.aside-collapsed #sidebarToggle {
          display: none !important; /* Hide the toggle button, Logo acts as toggle */
      }
      .sidebar.aside-collapsed .nav-item { 
        justify-content: center !important; 
        padding-left: 0 !important;
        padding-right: 0 !important;
      }
      /* 中文注释：折叠时缩小 Logo 尺寸，避免侧栏溢出 */
      .sidebar.aside-collapsed .sidebar-header img { 
        width: 2.5rem !important; 
        height: 2.5rem !important; 
      }
      
      /* 中文注释：折叠时图标稍微放大，提高可识别度 */
      .sidebar.aside-collapsed .material-symbols-outlined { 
        font-size: 1.5rem !important; 
        margin: 0 !important;
      }
      
      /* 中文注释：为折叠动画增加柔和过渡，避免突兀的跳变 */
      .sidebar * { 
        transition: all 0.2s ease-in-out; 
      }

      /* Tooltip styles for collapsed mode */
      .sidebar.aside-collapsed [data-tooltip]:hover::after {
          content: attr(data-tooltip);
          position: fixed;
          left: 4.5rem; /* Sidebar width + gap */
          z-index: 100;
          background: #1F2937;
          color: white;
          padding: 4px 8px;
          border-radius: 4px;
          font-size: 12px;
          white-space: nowrap;
          pointer-events: none;
          animation: fadeIn 0.2s;
          box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

      /* 中文注释：导航项激活状态样式 - 左侧渐变指示条 */
      .nav-item.active-item {
        position: relative;
        background: linear-gradient(90deg, rgba(74,105,255,0.1) 0%, rgba(74,105,255,0.05) 100%);
        color: #4A69FF;
      }
      
      .nav-item.active-item::before {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 3px;
        height: 70%;
        background: linear-gradient(180deg, #4A69FF 0%, #8A4FFF 100%);
        border-radius: 0 2px 2px 0;
      }
      
      .dark .nav-item.active-item {
        background: linear-gradient(90deg, rgba(74,105,255,0.2) 0%, rgba(74,105,255,0.1) 100%);
      }
      
      /* =============================
         Rune Card UI 辅助样式
         中文注释：配合统一模板的卡片结构，补充摘要截断、分隔线与标签基础样式
         ============================= */
      .rune-card { position: relative; }
      .rune-card-desc {
        display: -webkit-box; /* 采用弹性盒模型实现截断 */
        -webkit-line-clamp: 3; /* 最多显示 3 行 */
        -webkit-box-orient: vertical; /* 垂直排布 */
        overflow: hidden; /* 超出隐藏 */
      }
      .rune-card-divider {
        height: 1px;
        background: linear-gradient(90deg, rgba(0,0,0,0.06) 0%, rgba(0,0,0,0.03) 100%);
        border-radius: 9999px;
      }
      .dark .rune-card-divider {
        background: linear-gradient(90deg, rgba(255,255,255,0.12) 0%, rgba(255,255,255,0.08) 100%);
      }
      .rune-tag {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.5rem; /* px-2 py-1 */
        font-size: 0.75rem; /* text-xs */
        font-weight: 600; /* font-semibold */
        border-radius: 9999px; /* rounded-full */
      }
    </style>
    <style>
      /* 中文注释：统一按钮与 Digest 样式，提升一致性与现代感 */
      .btn { display:inline-flex; align-items:center; gap:.5rem; padding:.45rem .75rem; border-radius:.6rem; font-weight:600; font-size:.9rem; border:1px solid transparent; cursor:pointer; transition: transform .12s ease, box-shadow .12s ease; }
      .btn:active { transform: translateY(1px); }
      .btn-small { padding:.25rem .5rem; font-size:.78rem; border-radius:.5rem; }
      .btn-muted { background:#f3f4f6; color:#374151; border-color:#e6e7ea; }
      .btn-primary { background:linear-gradient(90deg,#4A69FF,#8A4FFF); color:#fff; box-shadow:0 6px 18px rgba(74,105,255,0.12); }
      .btn-outline { background:transparent; border:1px solid rgba(74,105,255,0.12); color:#334155; }
      .btn .spinner { width:14px; height:14px; border-radius:50%; border:2px solid rgba(255,255,255,0.35); border-top-color:#fff; animation:spin .9s linear infinite; }
      @keyframes spin { to { transform: rotate(360deg); } }
      .rune-tag { padding:.18rem .5rem; border-radius:999px; font-size:.78rem; font-weight:600; display:inline-flex; align-items:center; gap:.4rem; }
      .digest-card { border-radius:1rem; padding:1rem; background:#fff; border:1px solid #eef2ff; box-shadow:0 6px 24px rgba(17,24,39,0.04); }
      .rune-card { border:1px solid #eef2ff; box-shadow:0 6px 24px rgba(17,24,39,0.04); }
      .digest-entries { display:grid; gap:.6rem; margin-top:.6rem; }
      .entry { background:#fbfdff; border-radius:.6rem; padding:.8rem; border:1px solid #f1f5f9; }
      .entry-title { font-weight:700; margin-bottom:.25rem; }
      .entry-meta { font-size:.85rem; color:#6b7280; margin-bottom:.5rem; }
      .small-muted { font-size:.8rem; color:#9CA3AF; }
      @media (max-width:900px) { .rune-tag { font-size:.72rem; } .btn { font-size:.85rem; } }
      /* 中文注释：Digest 网格容器（自适应列，最小宽度 280px） */
      .digest-grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; }
      /* 中文注释：卡片悬浮轻微浮起动画，风格与 All Links 保持一致 */
      .digest-card { transition: transform .12s ease, box-shadow .12s ease; }
      .digest-card:hover { transform: translateY(-2px); box-shadow:0 10px 28px rgba(17,24,39,0.06); }
      /* 中文注释：网站首字母图标列表（紧凑排布） */
      .site-icon { width:28px; height:28px; border-radius:8px; background:#f3f4f6; display:flex; align-items:center; justify-content:center; font-weight:700; font-size:12px; }
      .site-icons { display:flex; gap:6px; flex-wrap:wrap; }
    </style>
  </head>
  <body class="bg-background-light dark:bg-background-dark font-display text-text-primary-light dark:text-text-primary-dark">
    <!-- ✅ 页面总体布局：侧栏 + 顶栏 + 主内容区 -->
    <div class="flex h-screen w-full">
      <!-- SideNavBar - 左侧导航栏（包含 LINKS/AI FEATURES/USER 分组） -->
      <aside id="sidebar" class="sidebar relative flex flex-col justify-between w-64 h-screen bg-surface-light dark:bg-surface-dark border-r border-gray-200 dark:border-gray-800 shrink-0 z-20" aria-expanded="true">
        <!-- 侧栏头部：Logo + 折叠按钮 -->
        <div class="sidebar-header flex items-center justify-between px-4 py-3 border-b border-gray-100 dark:border-gray-800">
          <button id="logoBtn" class="flex items-center gap-2 focus:outline-none focus:ring-2 focus:ring-primary/50 rounded-lg active:scale-95 transition-transform" aria-label="Toggle Sidebar" tabindex="0">
            <img src="logo/logo_icon.png" alt="Rune AI" class="w-10 h-10 rounded-full transition-all duration-300" />
            <div class="brand-text flex flex-col items-start">
               <h1 class="brand-title text-lg font-bold leading-tight">Rune AI</h1>
               <p class="brand-tagline text-xs text-text-secondary-light dark:text-text-secondary-dark font-normal tracking-wide">Runes of Intelligence</p>
            </div>
          </button>
          <!-- Sidebar Toggle Button (Optional, can be kept for mobile or explicit action) -->
          <button id="sidebarToggle" class="material-symbols-outlined text-2xl text-text-secondary-light dark:text-text-secondary-dark hidden" title="Toggle Sidebar">menu_open</button>
        </div>
        <!-- 侧栏主体：分组导航 -->
        <div class="sidebar-body flex-1 overflow-y-auto overflow-x-hidden custom-scrollbar">
          <nav id="sideNav" class="flex flex-col gap-3 px-4 py-2">
            <!-- LINKS 组：分类列表 + 新增分类按钮 -->
            <div class="rounded-lg">
              <button id="linksGroupHeader" class="flex items-center justify-between w-full px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 soft-hover" title="LINKS" data-tooltip="Links">
                <span class="nav-section-title">LINKS</span>
                <span class="material-symbols-outlined">expand_more</span>
              </button>
              <div id="linksGroupBody" class="flex flex-col gap-2 mt-1">
                <div id="linksGroupList" class="flex flex-col gap-2"></div>
                <button id="addCategoryBtn" class="mt-2 h-9 px-3 rounded-lg bg-gray-100 dark:bg-white/10 text-sm font-semibold hover:bg-gray-200 dark:hover:bg-white/20 soft-hover" title="New Category">+ New Category</button>
              </div>
            </div>
            <!-- AI FEATURES 组：Digest/Chat -->
            <div class="rounded-lg">
              <button id="aiGroupHeader" class="flex items-center justify-between w-full px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 soft-hover" title="AI FEATURES" data-tooltip="AI Features">
                <span class="nav-section-title">AI FEATURES</span>
                <span class="material-symbols-outlined">expand_more</span>
              </button>
              <div id="aiGroupBody" class="flex flex-col gap-2 mt-1">
                <a id="navDigest" href="#" class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 soft-hover" title="AI Digest" data-tooltip="AI Digest">
                  <span class="material-symbols-outlined text-xl">article</span>
                  <span class="nav-label text-sm font-medium leading-normal">AI Digest</span>
                  <span id="digestDot" class="dot-indicator ml-auto hidden"></span>
                </a>
                <a id="navChat" href="#" class="nav-item flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 dark:hover:bg-white/10 soft-hover" title="Chat / AI Assistant" data-tooltip="Chat / AI Assistant">
                  <span class="material-symbols-outlined text-xl">chat</span>
                  <span class="nav-label text-sm font-medium leading-normal">Chat / AI Assistant</span>
                </a>
              </div>
            </div>
          </nav>
        </div>
      </aside>

      <!-- Main Content - 顶栏 + 主区域 -->
      <div id="mainScrollContainer" class="flex flex-1 flex-col overflow-y-auto">
        <!-- 顶栏：品牌 + 搜索 + 操作区 + 用户系统区域 -->
        <header class="flex h-16 items-center justify-between whitespace-nowrap border-b border-gray-200 dark:border-gray-800 bg-surface-light dark:bg-surface-dark px-6 sticky top-0 z-10">
          <div class="flex flex-1 items-center gap-6">
            <div class="flex items-center gap-3 md:hidden">
               <!-- Mobile Toggle -->
               <button id="mobileSidebarToggle" class="material-symbols-outlined text-2xl text-text-secondary-light dark:text-text-secondary-dark">menu</button>
            </div>
            <div class="flex items-center gap-3">
              <h1 class="brand-title text-lg font-bold leading-tight md:hidden">Rune AI</h1>
              <!-- Desktop title hidden in header if sidebar is expanded, but let's keep it for now as per original design -->
            </div>
            <label class="flex flex-col min-w-40 w-full max-w-lg">
              <div class="flex w-full flex-1 items-stretch rounded-lg h-10">
                <div class="text-text-secondary-light dark:text-text-secondary-dark flex bg-gray-100 dark:bg:white/5 items-center justify-center pl-3 pr-2 rounded-l-lg">
                  <span class="material-symbols-outlined text-xl">search</span>
                </div>
                <input id="searchInput" class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-r-lg text-text-primary-light dark:text-text-primary-dark focus:outline-0 focus:ring-2 focus:ring-primary/50 border-none bg-gray-100 dark:bg-white/5 h-full placeholder:text-text-secondary-light dark:placeholder:text-text-secondary-dark p-2 text-sm font-normal leading-normal" placeholder="Search links or ask AI..." />
              </div>
            </label>
          </div>
          <div class="flex flex-shrink-0 items-center justify-end gap-4">
            <button id="addLinkBtn" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 gap-2 bg-primary text-white text-sm font-bold leading-normal tracking-[0.015em] hover:bg-primary/90">
              <span class="material-symbols-outlined text-xl">add</span>
              <span class="truncate">Add Link</span>
            </button>
            <button class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 bg-gray-100 dark:bg-white/5 text-text-secondary-light dark:text-text-secondary-dark text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5">
              <span class="material-symbols-outlined">notifications</span>
            </button>
            <!-- 用户系统区域：头像下拉容器 -->
            <div id="userSystemArea" class="flex items-center gap-2">
              <div id="userDropdownContainer" class="relative"><!-- 由 JS 动态加载用户下拉；Dashboard 场景下隐藏登录/注册按钮，仅显示已登录头像 --></div>
            </div>
          </div>
        </header>

        <!-- 主内容区：欢迎卡片 + 页面标题 + 卡片网格 + 调试按钮 -->
        <main class="flex-1 p-6">
          <div id="userWelcomeCard" class="mb-6"><!-- 由 JS 动态加载欢迎卡片 --></div>
          <div class="flex flex-wrap justify-between gap-3 mb-6">
            <h1 class="text-text-primary-light dark:text-text-primary-dark text-3xl font-bold leading-tight tracking-tight">All Links</h1>
          </div>
          <div id="cardsContainer" class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"></div>
          <div class="mt-6">
           
          </div>
        </main>
      </div>
    </div>

    <!-- Add Link 模态：默认隐藏，避免页面堆叠 -->
    <div id="addLinkModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
      <div id="addLinkBackdrop" class="absolute inset-0 bg-black/40"></div>
      <div class="relative w-full max-w-lg rounded-xl bg-surface-light dark:bg-surface-dark shadow-xl border border-gray-200 dark:border-gray-700 p-6">
        <h3 class="text-xl font-bold mb-4">Add a New Link</h3>
        <div class="grid grid-cols-1 gap-3">
          <label class="text-sm">URL
            <input id="inpUrl" class="mt-1 w-full form-input rounded-lg bg-gray-100 dark:bg-white/5 border-none focus:ring-2 focus:ring-primary/50" placeholder="https://example.com" />
          </label>
          <p class="text-xs text-text-secondary-light dark:text-text-secondary-dark">Just paste the URL; AI auto-generates other info.</p>
        </div>
        <div class="mt-5 flex justify-end gap-3">
          <button id="cancelAddLinkBtn" class="h-10 px-4 rounded-lg bg-gray-100 dark:bg-white/10 text-sm font-semibold">Cancel</button>
          <button id="saveLinkBtn" class="h-10 px-4 rounded-lg bg-primary text-white text-sm font-bold">Save</button>
        </div>
        <button id="closeModalX" class="absolute top-3 right-3 text-text-secondary-light dark:text-text-secondary-dark">
          <span class="material-symbols-outlined">close</span>
        </button>
  </div>
</div>

    <!-- Edit Link 模态：默认隐藏 -->
    <div id="editLinkModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
      <div class="absolute inset-0 bg-black/40"></div>
      <div class="relative bg-surface-light dark:bg-surface-dark rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 p-6 max-w-md w-full">
        <h3 class="text-lg font-bold mb-4 text-text-primary-light dark:text-text-primary-dark">Edit Link</h3>
        <form id="editLinkForm" class="flex flex-col gap-3">
          <input id="editLinkTitle" type="text" placeholder="Title" class="form-input h-10 rounded-lg border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-white/5 px-3" />
          <input id="editLinkURL" type="text" placeholder="URL" class="form-input h-10 rounded-lg border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-white/5 px-3" />
          <textarea id="editLinkDesc" placeholder="Description" rows="3" class="form-textarea rounded-lg border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-white/5 px-3"></textarea>
          <input id="editLinkTags" type="text" placeholder="Tags (comma separated)" class="form-input h-10 rounded-lg border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-white/5 px-3" />
          <select id="editLinkCategory" class="form-select h-10 rounded-lg border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-white/5 px-3">
            <option value="">Select Category</option>
          </select>
          <!-- 中文注释：当选择“新增分类”时展示此输入框，用于输入新分类名称 -->
          <input id="editLinkCategoryNew" type="text" placeholder="New category" class="form-input h-10 rounded-lg border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-white/5 px-3 hidden" />
          <div class="flex justify-end gap-3 mt-4">
            <button type="button" id="cancelEditBtn" class="h-10 px-4 rounded-lg bg-gray-100 dark:bg-white/10 text-sm font-semibold hover:bg-gray-200 dark:hover:bg-white/20">Cancel</button>
            <button type="submit" class="h-10 px-4 rounded-lg bg-primary text-white text-sm font-bold hover:bg-primary/90">Save Changes</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Add Category 模态：默认隐藏 -->
    <div id="addCategoryModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
      <div id="addCategoryBackdrop" class="absolute inset-0 bg-black/40"></div>
      <div class="relative w-full max-w-lg rounded-xl bg-surface-light dark:bg-surface-dark shadow-xl border border-gray-200 dark:border-gray-700 p-6">
        <h3 class="text-xl font-bold mb-4">Add a New Category</h3>
        <div class="grid grid-cols-1 gap-3">
          <label class="text-sm">Category Name
            <input id="inpCategoryName" class="mt-1 w-full form-input rounded-lg bg-gray-100 dark:bg-white/5 border-none focus:ring-2 focus:ring-primary/50" placeholder="e.g. ML Papers" />
          </label>
        </div>
        <div class="mt-5 flex justify-end gap-3">
          <button id="cancelCategoryBtn" class="h-10 px-4 rounded-lg bg-gray-100 dark:bg-white/10 text-sm font-semibold">Cancel</button>
          <button id="saveCategoryBtn" class="h-10 px-4 rounded-lg bg-primary text-white text-sm font-bold">Save</button>
        </div>
        <button id="closeCategoryX" class="absolute top-3 right-3 text-text-secondary-light dark:text-text-secondary-dark">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
    </div>

    <!-- Confirm 通用确认模态：默认隐藏 -->
    <div id="confirmModal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
      <div class="absolute inset-0 bg-black/40"></div>
      <div class="relative bg-surface-light dark:bg-surface-dark rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 p-6 max-w-sm w-full">
        <h3 id="confirmTitle" class="text-lg font-bold mb-4 text-text-primary-light dark:text-text-primary-dark">Delete item?</h3>
        <p id="confirmMessage" class="text-sm text-text-secondary-light dark:text-text-secondary-dark mb-6">This action cannot be undone.</p>
        <div class="flex justify-end gap-3">
          <button id="confirmCancel" class="h-10 px-4 rounded-lg bg-gray-100 dark:bg-white/10 text-sm font-semibold hover:bg-gray-200 dark:hover:bg-white/20">Cancel</button>
          <button id="confirmOk" class="h-10 px-4 rounded-lg bg-red-500 text-white text-sm font-bold hover:bg-red-600">Delete</button>
        </div>
      </div>
    </div>

    <!-- Frequency Modal：设置订阅更新频率（替代 prompt） -->
    <div id="freqModal" class="hidden fixed inset-0 z-60 flex items-center justify-center">
      <div class="modal-backdrop fixed inset-0 bg-black/40"></div>
      <div class="relative bg-white dark:bg-surface-dark rounded-xl shadow-xl w-full max-w-md p-5 z-70">
        <h3 class="text-lg font-semibold mb-3">Set frequency</h3>
        <label class="text-sm text-gray-600 dark:text-text-secondary-dark">Choose subscription update frequency</label>
        <select id="freqSelect" class="form-select mt-2 w-full rounded-lg bg-gray-100 dark:bg-white/5 border-none text-sm p-2">
          <option value="manual">Manual</option>
          <option value="every_1m">Every 1 minute (dev)</option>
          <option value="hourly">Hourly</option>
          <option value="every_6h">Every 6 hours</option>
          <option value="daily">Daily</option>
        </select>
        <div class="mt-4 flex justify-end gap-3">
          <button id="freqCancel" class="btn btn-small btn-muted">Cancel</button>
          <button id="freqOk" class="btn btn-small btn-primary">OK</button>
        </div>
      </div>
    </div>

    <!-- 用户系统弹窗容器（内容由组件注入，默认保持隐藏） -->
    <!-- 中文注释：Dashboard 是登录后的页面，此处不再包含“登录/注册”容器。
         仅保留“资料/设置”等已登录用户相关的弹窗容器。登录与注册改由 index 页面负责。-->
    <div id="modalBackdrop" class="fixed inset-0 bg-black/50 z-40 hidden"></div>
    <div id="userModalsContainer">
      <!-- 已登录用户相关弹窗容器（保留） -->
      <div id="profileModalContainer"></div>
      <div id="settingsModalContainer"></div>
    </div>
    <!-- Digest 弹窗容器（组件由入口注入到 body；此处无需额外容器） -->

    <!-- ✅ 脚本引用：入口唯一，统一由 js/main.js 控制路由与挂载 -->
    <!-- Phase 5: 使用 dashboard_init.js 进行初始化 -->
    <script type="module" src="js/dashboard_init.js"></script>
    <script type="module" src="js/main.js"></script>
    <!-- 中文注释：通用文本输入模态，用于替代 prompt()，防止浏览器禁用导致交互失败 -->
    <div id="textPromptModal" style="display:none;position:fixed;inset:0;align-items:center;justify-content:center;z-index:60;">
      <div style="width:100%;max-width:560px;background:#fff;border-radius:12px;padding:18px;box-shadow:0 10px 30px rgba(2,6,23,0.12);">
        <h3 id="textPromptTitle" style="margin:0 0 8px;font-size:16px;font-weight:700"></h3>
        <input id="textPromptInput" type="text" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6e9" />
        <div style="margin-top:12px;text-align:right">
          <button id="textPromptCancel" class="btn btn-small btn-muted">Cancel</button>
          <button id="textPromptOk" class="btn btn-small btn-primary">OK</button>
        </div>
      </div>
    </div>
  </body>
</html>