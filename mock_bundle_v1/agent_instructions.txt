# Mock Data Integration Instructions

## Overview
此 Mock 包旨在帮助前端工程师在脱离 Supabase 后端的情况下开发和测试 UI。它包含了一组 JSON 数据文件和 UI 状态 Fixtures。

## 1. 快速接入 (Quick Start)

### 步骤 A: 引入 Mock Service
在 `src/services/` 下创建或修改 `mockService.js`：

```javascript
// src/services/mockService.js

// 根据环境变量控制是否启用
const USE_MOCK = import.meta.env.VITE_USE_MOCK === 'true';

const MOCK_DATA = {
  cards: import.meta.glob('../mock_bundle_v1/mock_cards.json', { eager: true }),
  categories: import.meta.glob('../mock_bundle_v1/mock_categories.json', { eager: true }),
  fixtures: {
    loading: import.meta.glob('../mock_bundle_v1/ui_fixtures/cards-loading.json', { eager: true }),
    error: import.meta.glob('../mock_bundle_v1/ui_fixtures/cards-error.json', { eager: true }),
    empty: import.meta.glob('../mock_bundle_v1/ui_fixtures/cards-empty.json', { eager: true }),
  }
};

export const mockApi = {
  getCards: async (scenario = 'default') => {
    if (!USE_MOCK) return; // 让真实 API 处理
    
    await delay(300); // 模拟网络延迟
    
    switch(scenario) {
      case 'loading': return new Promise(() => {}); // 永不返回或返回特定 loading 态
      case 'error': throw MOCK_DATA.fixtures.error.default;
      case 'empty': return MOCK_DATA.fixtures.empty.default;
      default: return MOCK_DATA.cards.default; // mock_cards.json
    }
  },
  
  getCategories: async () => {
    if (!USE_MOCK) return;
    await delay(200);
    return MOCK_DATA.categories.default;
  },

  subscribe: async (cardId) => {
    if (!USE_MOCK) return;
    await delay(400);
    return { success: true, status: 'subscribed' };
  }
};

function delay(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}
```

### 步骤 B: 配置环境变量
在 `.env.development` 中添加：
```bash
VITE_USE_MOCK=true
```

### 步骤 C: 替换 API 调用
在你的 Controller 或 Component 中：

```javascript
import { supabase } from './supabaseClient';
import { mockApi } from './mockService';

const isMock = import.meta.env.VITE_USE_MOCK === 'true';

async function fetchCards() {
  if (isMock) {
    return await mockApi.getCards();
  }
  // Original Logic
  const { data } = await supabase.from('cards').select('*');
  return data;
}
```

## 2. 切换测试场景 (Switching Scenarios)

可以通过 URL 参数或简单的代码开关来测试不同状态：

*   **Loading 测试**: 修改 `mockApi.getCards('loading')`
*   **Error 测试**: 修改 `mockApi.getCards('error')`
*   **Empty 测试**: 修改 `mockApi.getCards('empty')`
*   **大数据量测试**: 加载 `cards-500-items.json`

## 3. CI/CD 集成

在运行 Cypress 或 Vitest 时，可以通过挂载 fixtures 来拦截网络请求：

```javascript
// Cypress example
cy.intercept('GET', '/api/cards', { fixture: 'cards-100.json' });
```

## 4. 特殊数据说明

*   **Images**: 使用了 `placehold.co` 作为图片占位符。
*   **Edge Cases**:
    *   Index 0: 超长标题。
    *   Index 1-8: 长预览文本。
    *   Index 37-39: 超高浏览量。
    *   Status `error`: 包含 `meta.error_message`。

---
Generated by RuneAI Agent.
